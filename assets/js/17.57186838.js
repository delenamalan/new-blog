(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{391:function(a,t,s){"use strict";s.r(t);var e=s(42),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"how-to-chain-laravel-mails-in-two-different-ways"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-chain-laravel-mails-in-two-different-ways"}},[a._v("#")]),a._v(" How to chain Laravel mails in two different ways")]),a._v(" "),s("DateComponent",{attrs:{page:a.$page}}),a._v(" "),s("h2",{attrs:{id:"introduction"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[a._v("#")]),a._v(" Introduction")]),a._v(" "),s("p",[a._v("Laravel makes it "),s("a",{attrs:{href:"https://laravel.com/docs/5.8/mail",target:"_blank",rel:"noopener noreferrer"}},[a._v("simple"),s("OutboundLink")],1),a._v(" for you to build and send emails. It also allows you to queue emails. However, even though it uses jobs in the background to queue mails, it doesn't provide us with a simple way to chain mails in the same way we can "),s("a",{attrs:{href:"https://laravel.com/docs/5.8/queues#job-chaining",target:"_blank",rel:"noopener noreferrer"}},[a._v("chain jobs"),s("OutboundLink")],1),a._v(" (yet). In this article we'll explore two ways in which we could chain mails, in other words, how we can send a list of mails, one after each other, provided the preceeding mail was sent successfully.")]),a._v(" "),s("h2",{attrs:{id:"our-example"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#our-example"}},[a._v("#")]),a._v(" Our Example")]),a._v(" "),s("p",[a._v("Sometimes we only want to send a mail after we are sure some other mail or mails have been sent successfully. For example, we might have a form on our site that end-users can use to send messages to our site's administrators. In this case we might want to send a confirmation email to the end-user once we have successfully sent their message to the administrators.")]),a._v(" "),s("p",[a._v("Let's say we have two "),s("a",{attrs:{href:"https://laravel.com/docs/5.8/mail#generating-mailables",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("Mailable")]),s("OutboundLink")],1),a._v(" classes for the two types of mails we want to send:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("ContactFormSubmitted(User $user, ContactForm $data)")]),a._v(": The mail that should be sent to our site's administrators when a user has submitted a message to the contact form. It's constructor takes two parameters:\n"),s("ul",[s("li",[s("code",[a._v("User $user")]),a._v(": the user who submitted the contact form.")]),a._v(" "),s("li",[s("code",[a._v("array $data")]),a._v(": an array that contains the data the user submitted to the contact form.")])])]),a._v(" "),s("li",[s("code",[a._v("ContactFormSubmmitedConfirmation")]),a._v(": The mail that should be sent to the user who submitted the contact form to confirm that we have successfully sent their submission to our site's administrators. It's constructor takes the same two parameters as the "),s("code",[a._v("ContactFormSubmitted")]),a._v("'s constructor, "),s("code",[a._v("$user")]),a._v(" and "),s("code",[a._v("$data")]),a._v(".")])]),a._v(" "),s("h2",{attrs:{id:"solution-1-create-a-new-job-that-sends-the-mails-to-be-chain-synchronously"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#solution-1-create-a-new-job-that-sends-the-mails-to-be-chain-synchronously"}},[a._v("#")]),a._v(" Solution 1: Create a new job that sends the mails to be chain synchronously")]),a._v(" "),s("h3",{attrs:{id:"the-idea"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-idea"}},[a._v("#")]),a._v(" The Idea")]),a._v(" "),s("p",[a._v("This is the simplest solution between our two solutions. The idea here is to create a new job class and to send our mails one after the other using the "),s("code",[a._v("->send")]),a._v(" method inside the "),s("code",[a._v("handle")]),a._v(" method of the job.")]),a._v(" "),s("p",[a._v("Of course, if our mailables implemented the "),s("code",[a._v("ShouldQueue")]),a._v(" contract, they would be queued even if we called the "),s("code",[a._v("->send")]),a._v(" method on them and thus we would have no idea whether they were sent successfully before sending the next mail. Thus none of our mailables should implement the "),s("code",[a._v("ShouldQueue")]),a._v(" contract for this solution to work.")]),a._v(" "),s("h3",{attrs:{id:"implementation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[a._v("#")]),a._v(" Implementation")]),a._v(" "),s("h4",{attrs:{id:"steps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#steps"}},[a._v("#")]),a._v(" Steps")]),a._v(" "),s("ol",[s("li",[a._v("First we generate a new job called "),s("code",[a._v("SendContactFormMails")]),a._v(" using "),s("code",[a._v("php artisan make:job SendContactFormMails")])]),a._v(" "),s("li",[a._v("Then we add the data we want to send to our mailables as parameters to the job's constructor. In this case, "),s("code",[a._v("User $user")]),a._v(" and "),s("code",[a._v("array $data")]),a._v(".")]),a._v(" "),s("li",[a._v("We add save the arguments from the constructor in "),s("code",[a._v("protected")]),a._v(" variables so that we can use them again later in the job's "),s("code",[a._v("handle")]),a._v(" method.")]),a._v(" "),s("li",[a._v("We add create and send the mails like we normally would, one after the other in the order than we want them to be chained. If one of them fails, the job would fail and the rest of the mails will not be sent.")]),a._v(" "),s("li",[a._v("Finally, we set the jobs "),s("code",[a._v("$tries")]),a._v(" value to one. Otherwise the job might be run and some of the mails would be sent more than once.")])]),a._v(" "),s("h4",{attrs:{id:"result"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#result"}},[a._v("#")]),a._v(" Result")]),a._v(" "),s("div",{staticClass:"language-php line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Mail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ContactFormSubmmitedConfirmation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Mail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ContactFormSubmitted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Bus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queueable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("SerializesModels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("InteractsWithQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Contracts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ShouldQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Foundation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Bus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Dispatchable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Mail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SendContactFormMails")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ShouldQueue")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Dispatchable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" InteractsWithQueue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Queueable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" SerializesModels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$tries")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("__construct")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("User "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("array")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Send the ContactFormSubmitted mail synchronously")]),a._v("\n      Mail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'mail.site_admin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ContactFormSubmitted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Send the ContactFormSubmittedConfirmation mail once the")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ContactFormSubmitted mail was successfully sent")]),a._v("\n      Mail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'email'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ContactFormSubmmitedConfirmation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br")])]),s("h3",{attrs:{id:"reflection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reflection"}},[a._v("#")]),a._v(" Reflection")]),a._v(" "),s("p",[a._v("This approach is easy to understand and implement. However, it is not an easily "),s("em",[a._v("reusable")]),a._v(" solution. Once we have other mails that we want to chain we would have to create separate custom jobs.")]),a._v(" "),s("h2",{attrs:{id:"solution-2-extend-the-sendqueuedmailable-job-that-laravel-creates-and-chain-that-job"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#solution-2-extend-the-sendqueuedmailable-job-that-laravel-creates-and-chain-that-job"}},[a._v("#")]),a._v(" Solution 2: Extend the "),s("code",[a._v("SendQueuedMailable")]),a._v(" job that Laravel creates and chain that job")]),a._v(" "),s("h3",{attrs:{id:"laravel-background"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#laravel-background"}},[a._v("#")]),a._v(" Laravel background")]),a._v(" "),s("p",[a._v("For this solution we need to understand a little bit more about how Laravel queues mails in the background.")]),a._v(" "),s("p",[a._v("Laravel's generated mail classes extend from the "),s("a",{attrs:{href:"https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/Mailable.php",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("Illuminate\\Mail\\Mailable")]),s("OutboundLink")],1),a._v(" class.\nThe "),s("code",[a._v("Mail")]),a._v(" facade uses the "),s("a",{attrs:{href:"https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/Mailer.php",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("Illuminate\\Mail\\Mailer")]),s("OutboundLink")],1),a._v(" to create a new "),s("a",{attrs:{href:"https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/PendingMail.php",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("PendingMail")]),s("OutboundLink")],1),a._v(" object. When you run "),s("code",[a._v("queue")]),a._v(" on either the "),s("code",[a._v("Mailer")]),a._v(" class or the "),s("code",[a._v("PendingMail")]),a._v(" object it calls the "),s("code",[a._v("queue")]),a._v(" function on the "),s("code",[a._v("Mailable")]),a._v(" object. The "),s("code",[a._v("queue")]),a._v(" method in the "),s("code",[a._v("Mailable")]),a._v(" class creates a new "),s("a",{attrs:{href:"https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/SendQueuedMailable.php",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("Illuminate\\Mail\\SendQueuedMailable")]),s("OutboundLink")],1),a._v(" job with the "),s("code",[a._v("Mailable")]),a._v(" object as a parameter, and pushes the job to the queue. Finally, when the "),s("code",[a._v("SendQueuedMailable")]),a._v(" job is handled it calls the "),s("code",[a._v("send")]),a._v(" method on the "),s("code",[a._v("Mailable")]),a._v(" class.")]),a._v(" "),s("h3",{attrs:{id:"the-idea-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-idea-2"}},[a._v("#")]),a._v(" The Idea")]),a._v(" "),s("p",[a._v("The idea for this solution is to make the job that Laravel creates (the "),s("code",[a._v("SendQueuedMailable")]),a._v(' job) "chainable." Then we\'ll be able to create these jobs ourselves using '),s("code",[a._v("Mailable")]),a._v(" objects and finally, we'll be able to chain those jobs.")]),a._v(" "),s("h3",{attrs:{id:"implementation-step-1-extend-the-sendqueuedmailable-class-to-make-it-chainable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#implementation-step-1-extend-the-sendqueuedmailable-class-to-make-it-chainable"}},[a._v("#")]),a._v(" Implementation Step 1: Extend the "),s("code",[a._v("SendQueuedMailable")]),a._v(' class to make it "chainable"')]),a._v(" "),s("div",{staticClass:"language-php line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Bus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queueable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Contracts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ShouldQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Foundation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Bus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Dispatchable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Mail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("SendQueuedMailable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SendDispatchableMail")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SendQueuedMailable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ShouldQueue")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Dispatchable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Queueable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("h3",{attrs:{id:"implementation-step-2-chain-senddispatchablemail-jobs-using-mailable-objects"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#implementation-step-2-chain-senddispatchablemail-jobs-using-mailable-objects"}},[a._v("#")]),a._v(" Implementation Step 2: Chain "),s("code",[a._v("SendDispatchableMail")]),a._v(" jobs using "),s("code",[a._v("Mailable")]),a._v(" objects")]),a._v(" "),s("div",{staticClass:"language-php line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create the ContactFormSubmitted mail (but don't send it yet)")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$admin_mailable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ContactFormSubmitted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$admin_mailable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'mail.site_admin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create the ContactFormSubmittedConfirmation mail (but don't send it yet)")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user_mailable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ContactFormSubmittedConfirmation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user_mailable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'email'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create SendDispatchableMail jobs, chain and dispatch them")]),a._v("\n\nSendDispatchableMail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$admin_mailable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SendDispatchableMail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user_mailable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h3",{attrs:{id:"reflection-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reflection-2"}},[a._v("#")]),a._v(" Reflection")]),a._v(" "),s("p",[a._v("This approach is difficult to understand and it uses non-standard ways to create and send mails, thus it feels "),s("em",[a._v("hacky")]),a._v(". I also don't like extending and using Laravel classes in ways that it was not intended to be used, because they might create issues when we want to upgrade to a new Laravel release.")]),a._v(" "),s("p",[a._v("The only benefit I see in this solution is that it is reusable. You don't have to create a new custom job for every chain of mails that you want to send like you would have to do when you use the first solution.")])],1)}),[],!1,null,null,null);t.default=n.exports}}]);