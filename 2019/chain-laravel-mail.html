<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to chain Laravel mails in two different ways | Delena Malan</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/logo-small.png">
    <meta name="description" content="Delena Malan">
    <link rel="preload" href="/assets/css/0.styles.f0371090.css" as="style"><link rel="preload" href="/assets/js/app.7a72154f.js" as="script"><link rel="preload" href="/assets/js/3.f60f5d55.js" as="script"><link rel="preload" href="/assets/js/1.882304ba.js" as="script"><link rel="preload" href="/assets/js/17.57186838.js" as="script"><link rel="preload" href="/assets/js/8.dc2fa637.js" as="script"><link rel="prefetch" href="/assets/js/10.ff781af4.js"><link rel="prefetch" href="/assets/js/11.7aba05ca.js"><link rel="prefetch" href="/assets/js/12.0117c602.js"><link rel="prefetch" href="/assets/js/13.81d7c8db.js"><link rel="prefetch" href="/assets/js/14.f83f74ba.js"><link rel="prefetch" href="/assets/js/15.a31ff00d.js"><link rel="prefetch" href="/assets/js/16.6998f877.js"><link rel="prefetch" href="/assets/js/18.51b8d96c.js"><link rel="prefetch" href="/assets/js/19.3b66d550.js"><link rel="prefetch" href="/assets/js/20.be4a9d7e.js"><link rel="prefetch" href="/assets/js/21.4b247413.js"><link rel="prefetch" href="/assets/js/22.6afec913.js"><link rel="prefetch" href="/assets/js/23.5ba5a209.js"><link rel="prefetch" href="/assets/js/24.ae7929ce.js"><link rel="prefetch" href="/assets/js/4.c819f313.js"><link rel="prefetch" href="/assets/js/5.e6b5b41c.js"><link rel="prefetch" href="/assets/js/6.9e30c69c.js"><link rel="prefetch" href="/assets/js/7.fc8e21eb.js"><link rel="prefetch" href="/assets/js/9.154ec9e7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f0371090.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo-small.png" alt="Delena Malan" class="logo"> <span class="site-name can-hide">Delena Malan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://gist.github.com/delenamalan/4ae9986977e220fccdf665653db2b98c#file-delena-malan-cv-pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CV
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://gist.github.com/delenamalan/4ae9986977e220fccdf665653db2b98c#file-delena-malan-cv-pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CV
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>How to chain Laravel mails in two different ways</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2019/chain-laravel-mail.html#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2019/chain-laravel-mail.html#our-example" class="sidebar-link">Our Example</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2019/chain-laravel-mail.html#solution-1-create-a-new-job-that-sends-the-mails-to-be-chain-synchronously" class="sidebar-link">Solution 1: Create a new job that sends the mails to be chain synchronously</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#the-idea" class="sidebar-link">The Idea</a></li><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#implementation" class="sidebar-link">Implementation</a></li><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#reflection" class="sidebar-link">Reflection</a></li></ul></li><li><a href="/2019/chain-laravel-mail.html#solution-2-extend-the-sendqueuedmailable-job-that-laravel-creates-and-chain-that-job" class="sidebar-link">Solution 2: Extend the SendQueuedMailable job that Laravel creates and chain that job</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#laravel-background" class="sidebar-link">Laravel background</a></li><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#the-idea-2" class="sidebar-link">The Idea</a></li><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#implementation-step-1-extend-the-sendqueuedmailable-class-to-make-it-chainable" class="sidebar-link">Implementation Step 1: Extend the SendQueuedMailable class to make it &quot;chainable&quot;</a></li><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#implementation-step-2-chain-senddispatchablemail-jobs-using-mailable-objects" class="sidebar-link">Implementation Step 2: Chain SendDispatchableMail jobs using Mailable objects</a></li><li class="sidebar-sub-header"><a href="/2019/chain-laravel-mail.html#reflection-2" class="sidebar-link">Reflection</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-to-chain-laravel-mails-in-two-different-ways"><a href="#how-to-chain-laravel-mails-in-two-different-ways" class="header-anchor">#</a> How to chain Laravel mails in two different ways</h1> <div class="post-date" data-v-2152cbad>
  Tue Apr 16 2019
</div> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Laravel makes it <a href="https://laravel.com/docs/5.8/mail" target="_blank" rel="noopener noreferrer">simple<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for you to build and send emails. It also allows you to queue emails. However, even though it uses jobs in the background to queue mails, it doesn't provide us with a simple way to chain mails in the same way we can <a href="https://laravel.com/docs/5.8/queues#job-chaining" target="_blank" rel="noopener noreferrer">chain jobs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (yet). In this article we'll explore two ways in which we could chain mails, in other words, how we can send a list of mails, one after each other, provided the preceeding mail was sent successfully.</p> <h2 id="our-example"><a href="#our-example" class="header-anchor">#</a> Our Example</h2> <p>Sometimes we only want to send a mail after we are sure some other mail or mails have been sent successfully. For example, we might have a form on our site that end-users can use to send messages to our site's administrators. In this case we might want to send a confirmation email to the end-user once we have successfully sent their message to the administrators.</p> <p>Let's say we have two <a href="https://laravel.com/docs/5.8/mail#generating-mailables" target="_blank" rel="noopener noreferrer"><code>Mailable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> classes for the two types of mails we want to send:</p> <ul><li><code>ContactFormSubmitted(User $user, ContactForm $data)</code>: The mail that should be sent to our site's administrators when a user has submitted a message to the contact form. It's constructor takes two parameters:
<ul><li><code>User $user</code>: the user who submitted the contact form.</li> <li><code>array $data</code>: an array that contains the data the user submitted to the contact form.</li></ul></li> <li><code>ContactFormSubmmitedConfirmation</code>: The mail that should be sent to the user who submitted the contact form to confirm that we have successfully sent their submission to our site's administrators. It's constructor takes the same two parameters as the <code>ContactFormSubmitted</code>'s constructor, <code>$user</code> and <code>$data</code>.</li></ul> <h2 id="solution-1-create-a-new-job-that-sends-the-mails-to-be-chain-synchronously"><a href="#solution-1-create-a-new-job-that-sends-the-mails-to-be-chain-synchronously" class="header-anchor">#</a> Solution 1: Create a new job that sends the mails to be chain synchronously</h2> <h3 id="the-idea"><a href="#the-idea" class="header-anchor">#</a> The Idea</h3> <p>This is the simplest solution between our two solutions. The idea here is to create a new job class and to send our mails one after the other using the <code>-&gt;send</code> method inside the <code>handle</code> method of the job.</p> <p>Of course, if our mailables implemented the <code>ShouldQueue</code> contract, they would be queued even if we called the <code>-&gt;send</code> method on them and thus we would have no idea whether they were sent successfully before sending the next mail. Thus none of our mailables should implement the <code>ShouldQueue</code> contract for this solution to work.</p> <h3 id="implementation"><a href="#implementation" class="header-anchor">#</a> Implementation</h3> <h4 id="steps"><a href="#steps" class="header-anchor">#</a> Steps</h4> <ol><li>First we generate a new job called <code>SendContactFormMails</code> using <code>php artisan make:job SendContactFormMails</code></li> <li>Then we add the data we want to send to our mailables as parameters to the job's constructor. In this case, <code>User $user</code> and <code>array $data</code>.</li> <li>We add save the arguments from the constructor in <code>protected</code> variables so that we can use them again later in the job's <code>handle</code> method.</li> <li>We add create and send the mails like we normally would, one after the other in the order than we want them to be chained. If one of them fails, the job would fail and the rest of the mails will not be sent.</li> <li>Finally, we set the jobs <code>$tries</code> value to one. Otherwise the job might be run and some of the mails would be sent more than once.</li></ol> <h4 id="result"><a href="#result" class="header-anchor">#</a> Result</h4> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Mail<span class="token punctuation">\</span>ContactFormSubmmitedConfirmation</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Mail<span class="token punctuation">\</span>ContactFormSubmitted</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Queueable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>InteractsWithQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Mail</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendContactFormMails</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithQueue<span class="token punctuation">,</span> Queueable<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$data</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token variable">$tries</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">data</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Send the ContactFormSubmitted mail synchronously</span>
      Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'mail.site_admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContactFormSubmitted</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Send the ContactFormSubmittedConfirmation mail once the</span>
      <span class="token comment">// ContactFormSubmitted mail was successfully sent</span>
      Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">to</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token single-quoted-string string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContactFormSubmmitedConfirmation</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="reflection"><a href="#reflection" class="header-anchor">#</a> Reflection</h3> <p>This approach is easy to understand and implement. However, it is not an easily <em>reusable</em> solution. Once we have other mails that we want to chain we would have to create separate custom jobs.</p> <h2 id="solution-2-extend-the-sendqueuedmailable-job-that-laravel-creates-and-chain-that-job"><a href="#solution-2-extend-the-sendqueuedmailable-job-that-laravel-creates-and-chain-that-job" class="header-anchor">#</a> Solution 2: Extend the <code>SendQueuedMailable</code> job that Laravel creates and chain that job</h2> <h3 id="laravel-background"><a href="#laravel-background" class="header-anchor">#</a> Laravel background</h3> <p>For this solution we need to understand a little bit more about how Laravel queues mails in the background.</p> <p>Laravel's generated mail classes extend from the <a href="https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/Mailable.php" target="_blank" rel="noopener noreferrer"><code>Illuminate\Mail\Mailable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> class.
The <code>Mail</code> facade uses the <a href="https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/Mailer.php" target="_blank" rel="noopener noreferrer"><code>Illuminate\Mail\Mailer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to create a new <a href="https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/PendingMail.php" target="_blank" rel="noopener noreferrer"><code>PendingMail</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> object. When you run <code>queue</code> on either the <code>Mailer</code> class or the <code>PendingMail</code> object it calls the <code>queue</code> function on the <code>Mailable</code> object. The <code>queue</code> method in the <code>Mailable</code> class creates a new <a href="https://github.com/laravel/framework/blob/5.8/src/Illuminate/Mail/SendQueuedMailable.php" target="_blank" rel="noopener noreferrer"><code>Illuminate\Mail\SendQueuedMailable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> job with the <code>Mailable</code> object as a parameter, and pushes the job to the queue. Finally, when the <code>SendQueuedMailable</code> job is handled it calls the <code>send</code> method on the <code>Mailable</code> class.</p> <h3 id="the-idea-2"><a href="#the-idea-2" class="header-anchor">#</a> The Idea</h3> <p>The idea for this solution is to make the job that Laravel creates (the <code>SendQueuedMailable</code> job) &quot;chainable.&quot; Then we'll be able to create these jobs ourselves using <code>Mailable</code> objects and finally, we'll be able to chain those jobs.</p> <h3 id="implementation-step-1-extend-the-sendqueuedmailable-class-to-make-it-chainable"><a href="#implementation-step-1-extend-the-sendqueuedmailable-class-to-make-it-chainable" class="header-anchor">#</a> Implementation Step 1: Extend the <code>SendQueuedMailable</code> class to make it &quot;chainable&quot;</h3> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Jobs</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Queueable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Mail<span class="token punctuation">\</span>SendQueuedMailable</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendDispatchableMail</span> <span class="token keyword">extends</span> <span class="token class-name">SendQueuedMailable</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
  <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> Queueable<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="implementation-step-2-chain-senddispatchablemail-jobs-using-mailable-objects"><a href="#implementation-step-2-chain-senddispatchablemail-jobs-using-mailable-objects" class="header-anchor">#</a> Implementation Step 2: Chain <code>SendDispatchableMail</code> jobs using <code>Mailable</code> objects</h3> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Create the ContactFormSubmitted mail (but don't send it yet)</span>

<span class="token variable">$admin_mailable</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContactFormSubmitted</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$admin_mailable</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'mail.site_admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the ContactFormSubmittedConfirmation mail (but don't send it yet)</span>

<span class="token variable">$user_mailable</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContactFormSubmittedConfirmation</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user_mailable</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create SendDispatchableMail jobs, chain and dispatch them</span>

SendDispatchableMail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$admin_mailable</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">SendDispatchableMail</span><span class="token punctuation">(</span><span class="token variable">$user_mailable</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="reflection-2"><a href="#reflection-2" class="header-anchor">#</a> Reflection</h3> <p>This approach is difficult to understand and it uses non-standard ways to create and send mails, thus it feels <em>hacky</em>. I also don't like extending and using Laravel classes in ways that it was not intended to be used, because they might create issues when we want to upgrade to a new Laravel release.</p> <p>The only benefit I see in this solution is that it is reusable. You don't have to create a new custom job for every chain of mails that you want to send like you would have to do when you use the first solution.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/27/2020, 11:46:25 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7a72154f.js" defer></script><script src="/assets/js/3.f60f5d55.js" defer></script><script src="/assets/js/1.882304ba.js" defer></script><script src="/assets/js/17.57186838.js" defer></script><script src="/assets/js/8.dc2fa637.js" defer></script>
  </body>
</html>
